<!DOCTYPE HTML>
<html>
<head>
	<title>The Trollers Game - Dama game written in HTML5 language</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<script>
 
	var DRAW_INTERVAL = 200;

	var AREA_WIDTH = 50;
	var AREA_HEIGHT = 50;

	var PIECE_PADDING = 5;

	var canvas;	// my canvas object
	var ctx;	// context
	var pieces = []; // pieces array

	var areas = [];

	function Player(name, cells, color, cpu) 
	{
		if (cpu == undefined) {
			cpu = false;
		}
		
		this.name = name;
		this.cells = cells; // player cell pointer
		this.cpu = cpu;
		this.color = color;
		
		this.initialize = function () 
		{
			// adiciona as peças
			if (this.cells.length > 0) 
			{
				for (var i in this.cells) {
					addPiece(this.cells[i], this.color);
				}
			}
			
			// adiciona as informações do usuário numa box...
			var user_type = this.cpu ? "CPU" : "User";
			document.getElementById('userinfo').innerHTML += "<div class='ublock'><div class='box' style='background-color: "+this.color+"'></div><strong>"+user_type+": </strong>"+this.name+" <br /><div class='ptsinfo'>Pontuação: <span class='pts'>0</span></div></div>";
		};
	}

	function Cell(row, column) 
	{
	    this.row = row;
	    this.column = column;
	}

	function Piece() 
	{
		this.column = 0;
		this.row = 0;
		this.fill = '#444444';
	
		this.draw = function () 
		{
			var radius = 20;
			ctx.strokeStyle = "#000000";
			ctx.fillStyle = this.fill; 
			ctx.beginPath();
			// context.arc(centerX, centerY, radius, startingAngle, endingAngle, antiClockwise);
			ctx.arc(this.column * AREA_WIDTH + radius + PIECE_PADDING, this.row * AREA_HEIGHT + radius + PIECE_PADDING, radius, 0, Math.PI*2, true);
			ctx.closePath();
			ctx.stroke();
			ctx.fill();
		}
	}

	function Area() 
	{
		this.column = 0;
		this.row = 0;
		this.playable = false;
		
		this.draw = function () 
		{
			if (this.playable) 
			{
				ctx.fillStyle = '#D18B47'; 
			} else {
				ctx.fillStyle = '#FFCE9E';
			}
			
			ctx.beginPath();
			ctx.fillRect(this.column * AREA_WIDTH, this.row * AREA_HEIGHT, AREA_WIDTH, AREA_HEIGHT);
			ctx.closePath();
			ctx.stroke();
			ctx.fill();
		}
	}

	function addPiece(cell, fill) 
	{
		var piece = new Piece;
		piece.column = cell.column;
		piece.row = cell.row;
		piece.fill = fill;
		pieces.push(piece);
		
		return cell;
	}

	function addArea(cell, playable) 
	{
		var area = new Area;
		area.column = cell.column;
		area.row = cell.row;
		area.playable = playable;
		areas.push(area);
	}
	
	function findAreaByPosition(cell) 
	{
		for (var i in areas) {
			var area = areas[i];
			if (area.playable && area.column == cell.column && area.row == cell.row) 
			{
				return area;
			}
		}
		
		return null;
	}
	
	function findPieceByPosition(cell) 
	{
		for (var i in pieces) {
			var piece = pieces[i];
			if (piece.column == cell.column && piece.row == cell.row) 
			{
				return piece;
			}
		}
		
		return null;
	}

	// player 1 information
	var piecesArr = [ new Cell(0, 0), new Cell(0, 2), new Cell(0, 4), new Cell(0, 6), new Cell(1, 1), new Cell(1, 3), new Cell(1, 5), new Cell(1, 7)];
	var player1 = new Player("Andrei Rosseti", piecesArr, '#AF0000');
	//
	
	// player 2 information
	var piecesArr = [ new Cell(6, 0), new Cell(6, 2), new Cell(6, 4), new Cell(6, 6), new Cell(7, 1), new Cell(7, 3), new Cell(7, 5), new Cell(7, 7)];
	var player2 = new Player("THOR", piecesArr, '#F4F2C4', true);
	//

	window.onload = function() 
	{
		canvas	= document.getElementById("canvas");
		ctx		= canvas.getContext("2d");

		canvas.addEventListener("click", 		canvasClickHandler, false);
		canvas.addEventListener("mousemove",	canvasMouseMoveHandler, false);
		//document.onmousemove = getMouseXY;
	//	canvas.addEventListener("mouseout",		canvasMouseOutHandler, false);
		
		for (var row = 0; row < 8; row++) 
		{
			for (var column = 0; column < 8; column++) 
			{
				var playable = false;
				
				if (((column+row) % 2) == 0) {
					playable = true;
				}
			
				addArea(new Cell(row, column), playable);
			}
		}
		
		player1.initialize();
		player2.initialize();
		
		setInterval("Main.drawloop()", DRAW_INTERVAL);
	
	}

	Main = 
	{
		drawloop: function () 
		{
			for (var i in areas) {
				areas[i].draw();
			}
		
			for (var i in pieces) {
				pieces[i].draw();
			}
			
		}
	
	}
	
	canvasClickHandler = function(e) {
		var cell = canvasGetMousePosition(e);
		var area;
		var piece;
		
		if ((area = findAreaByPosition(cell)) && (piece = findPieceByPosition(cell))) 
		{
			
		}
	}
	
	canvasMouseMoveHandler = function(e) 
	{
		var cell = canvasGetMousePosition(e);
		var area;
		var piece;
		
		if (findPieceByPosition(cell)) 
		{
			document.body.style.cursor = "pointer";
		} else {
			document.body.style.cursor = "";
		}
	}
	
	canvasGetMousePosition = function(e) 
	{
		var canvas = document.getElementById('canvas');
		var x;
		var y;

		if (e.pageX != undefined && e.pageY != undefined) {
			x = e.pageX;
			y = e.pageY;
		}
		else {
			x = e.clientX + document.body.scrollLeft +
			document.documentElement.scrollLeft;
			y = e.clientY + document.body.scrollTop +
			document.documentElement.scrollTop;
		}
		
		x -= canvas.offsetLeft;
		y -= canvas.offsetTop;
		
		var cell = new Cell(Math.floor(y/AREA_HEIGHT),
		                        Math.floor(x/AREA_WIDTH));
		return cell;
	}
 
	</script>
	<style type="text/css">
		body { font-family: "lucida grande", "arial"; font-size: 12px; }
		h1 { font-family: "lucida grande", "arial"; font-size: 28px; }
		h1 small { font-size: 12px; color: #888; font-weight: normal; display: block; }
		#main { width: 600px; margin: 0 auto; background: url('trollface.png') no-repeat top 280px; overflow: hidden; }
		.box { width: 26px; height: 26px; float: left; margin: 0 5px; border: 1px solid #444;	}
		#canvas { float: left; 	}
		#userinfo {
			float: left;
			margin-left: 5px;
		}
		#userinfo .ublock { overflow: hidden; margin: 5px 0; }
		#userinfo .ublock .ptsinfo { color: #888; font-size: 11px; }
		#userinfo .ublock .ptsinfo .pts { font-weight: bold; }
	</style>
</head>
<body>
	<div id="main">
		<h1>The trollers game <small>Dama game written in HTML5 language</small></h1>
		<canvas id="canvas" width="400" height="400"></canvas>
		<div id="userinfo"></div>
	</div>
</body>
</html>